

# 服务远程调用
用来发送http请求实现远程调用
服务提供者Provider：被其他微服务调用的服务，提供接口给其他微服务
服务消费者Consumer：调用其他微服务的服务，调用其他微服务提供的接口



# RestTemplate


```java
// RestTemplate
@MapperScan("cn.itcast.order.mapper")
@SpringBootApplication
public class OrderApplication {
    public static void main(String[] args){
        SpringApplication.run(OrderApplication.class,args);
    }
    @Bean//向容器里注册RestTemplate对象
    public RestTemplate restTemplate(){
        return new RestTemplate();}
}
//restTemplate.getForObject(url,User.class);调用的方法
String url = "http://userservice/user/"+order.getUserId();
User usre = restTemplate.getForObject(url,User.class);
//弊端: 可读性差，编程体验不统一，难以完成参数复杂的url
```



# Feign


```java

//Feign是声明式HTTP客户端，可以替代RestTemplate
帮助我们优雅的实现http请求的发送
导入依赖 org.springframework.cloud spring-cloud-starter-openfeign
@EnableFeignClients //在启动类上开启注解启动Feign功能
@SpringBootApplication
public class OrderApplication {
  SpringApplication.run(OrderApplication.class,args);
}

//声明远程调用
//String url = "http://userservice/user/"+order.getUserId();
//User usre = restTemplate.getForObject(url,User.class);
@FeignClient("userservice")
public interface UserClient {
  @GetMapping("/user/{id}")
  User findById(@PathVariable("id") Long id);
}

// 配置信息
feign.Logger.Level 日志级别
feign.codec.Decoder 响应结果解析器
feign.codec.Encoder 请求参数编码
feign.Contract 支持注解格式
feign.Retryer 失败重试机制

//性能优化，底层实现
URLConnection默认实现，不支持连接池
ApacheHttpClient支持连接池
OKHttp支持连接池
有连接池可以对性能减少一些损耗，因为连接池会储存一些重复使用的配置
把日志级别设置为none，关闭日志会提升很大的性能

/*
依赖 io.github.openfeign feign-httpclient
配置连接池
feign: 
  client:
    config:
      default: # default全局的配置
        loggerLevel: BASIC # 日志级别，BASIC就是基本的请求和响应信息
  httpclient:
    enabled: true # 开启feign对HttpClient的支持
    max-connections: 200 # 最大连接数
    max-connections-per-route: 50 # 每个路径的最大连接数
*/


```


















